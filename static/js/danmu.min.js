$((function(){var lockDown=!1,balanceServer=["http://mc.roselle.vip:26170/","http://server3.guidelogin.hcc.io/index.php","http://47.98.170.221/","http://212.64.89.107/","http://katyushaa.asuscomm.com:61080/"],submitButton=$("#send-danmu-form").children("button[type='submit']"),iconTranslate=["https://cdn.jsdelivr.net/gh/yangzhongtian001/imglib@master/boy.png","https://cdn.jsdelivr.net/gh/yangzhongtian001/imglib@master/girl.png"],fitScreen=function(stagemode=!1){if(stagemode)var send_panel_height=0,container_height=0;else var send_panel_height=$("#send-panel").height(),container_height=$("#navbar-container").height();var panelHight=$("body").height()-container_height;$(".page-panel").height(panelHight),$("#display-panel").height(panelHight-send_panel_height-40)},fullData=[],fullDatacnt=0,fullDatalayout=function(){var interv=window.setInterval((function(){fullData.length>0&&(fullDatacnt>=fullData.length&&(clearInterval(interv),fullDatacnt=0,window.setTimeout(fullDatalayout,1e3)),$("body").barrager(fullData[fullDatacnt++]))}),500)},loadData=function(){$.get("/danmu/get/",(function(r){fullData=[],r.forEach(e=>{fullData.push({img:iconTranslate[e.icon],href:"#",close:!1,info:e.text,color:e.color})})}))},triggerLoggedin=function(){$("#danmu-logout").show(),loadData(),window.setInterval(loadData,8e3)},loadBalanceServer=function(){var callback,service_name="在线开学手册",ext_url="?service_name=在线开学手册&callback="+(location.protocol+"//"+location.host+"/danmu/external_login/?param=");balanceServer.forEach((e,i)=>{$("#balanceServerList").append(`<a class="dropdown-item" href="${e+ext_url}">服务器${i+1}</a>`)})},enterStageMode=function(e){$("#navbar-container").hide(),$("#send-panel").hide(),fitScreen(!0)};$(window).resize(fitScreen),$("#send-danmu-form").submit((function(e){e.preventDefault();var danmu_text=$("#danmu-text").val(),danmu_color=$("#color-celection").val(),danmu_icon=Number($("#icon-celection").val());if(""==danmu_text||lockDown||danmu_text.length>40)swal("提示","发送失败：内容为空或长度超过限制","error");else{var danmu_config={img:iconTranslate[danmu_icon],info:"",href:"#",close:!1,color:danmu_color,old_ie_color:"#ffffff"};$("#danmu-text").val(""),$.post("/danmu/send/",{text:danmu_text,icon:danmu_icon,color:danmu_color},(function(r){if(1==r.status){danmu_config.info=r.text,$("body").barrager(danmu_config),lockDown=!0,submitButton.attr("disabled",!0);var locktime=3e3;setTimeout((function(){lockDown=!1,submitButton.attr("disabled",!1)}),3e3)}else-2==r.status?swal("提示","您的账号已被封禁","error"):swal("提示","发送未知错误 状态码"+r.status,"error")}))}})),$("#yunxiao-login").submit((function(e){e.preventDefault();var username=$("#yunxiao-username").val(),password=$("#yunxiao-password").val(),captchacode=$("#yunxiao-captchacode").val(),captchavalue=$("#yunxiao-captchavalue").val();""!=username&&""!=password?$.post("/danmu/login/",{username:username,password:password,captchacode:captchacode,captchavalue:captchavalue},(function(r){0==r.status?($("#loginModal").modal("hide"),1==r.is_admin&&($("#danmu-admin").show(),$("#danmu-stagemode").show()),triggerLoggedin()):-1==r.status?swal("登录失败","用户名或密码错误","error"):-2==r.status?($("#yunxiao-captchacode").val(r.captchacode),$("#yunxiao-captchaarea").show(),$("#yunxiao-captchadisplay").attr("src","https://account.yunxiao.com/captcha/"+r.captchacode+"?t="+(new Date).getMilliseconds()),swal("登录失败","用户名或密码错误","error")):-3==r.status?swal("登录失败","账号已被冻结请10分钟后再试","error"):3==r.status?swal("登录失败","验证码已过期请刷新页面","error"):swal("登录失败","服务器出现了一个未知错误","error")})):swal("登录失败","请填写所有内容","error")})),$("#color-celection").colorpicker({allowEmpty:!1,color:"#ffffff",showInput:!1,showInitial:!0,showPalette:!0,showSelectionPalette:!0,showAlpha:!1,maxPaletteSize:7,preferredFormat:"hex"}),$("#yunxiao-login-local").click((function(){$("#yunxiao-login-form").toggle(),$("#yunxiao-login-submit").toggle(),$("#yunxiao-login-notice").toggle()})),$("#color-celection").change((function(e){$("#color-celection").css("color",e.value.toString())})),$("#enter-stagemode").click(enterStageMode),$(document).ready((function(){fitScreen(),$(".selectpicker").selectpicker({showIcon:!0}),loadBalanceServer(),fullDatalayout(),"true"==window.loggedIn?triggerLoggedin():$("#loginModal").modal({backdrop:"static",keyboard:!1})}))}));