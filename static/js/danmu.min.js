$((function(){var lockDown=!1,balanceServer=["http://server3.guidelogin.hcc.io/index.php","http://mc.roselle.vip:26170/","http://47.98.170.221/","http://212.64.89.107/","http://katyushaa.asuscomm.com:61080/"],backgroundImage={large:["/static/img/danmu/large-min/background-large-1.jpg","/static/img/danmu/large-min/background-large-2.jpg","/static/img/danmu/large-min/background-large-3.jpg","/static/img/danmu/large-min/background-large-4.jpg","/static/img/danmu/large-min/background-large-5.jpg","/static/img/danmu/large-min/background-large-6.jpg"],small:["/static/img/danmu/small-min/background-small-1.jpg","/static/img/danmu/small-min/background-small-2.jpg","/static/img/danmu/small-min/background-small-3.jpg","/static/img/danmu/small-min/background-small-4.jpg","/static/img/danmu/small-min/background-small-5.jpg","/static/img/danmu/small-min/background-small-6.jpg","/static/img/danmu/small-min/background-small-7.jpg","/static/img/danmu/small-min/background-small-8.jpg"]},backgroundInterval,submitButton=$("#send-danmu-form").children("button[type='submit']"),iconTranslate=["/static/img/icons/boy.png","/static/img/icons/girl.png"],fitScreen=function(stagemode=0){if(stagemode)var send_panel_height=0,container_height=0,offset=0;else var send_panel_height=$("#send-panel").height(),container_height=$("#navbar-container").height(),offset=42;var panelHight=$("body").height()-container_height;$(".page-panel").height(panelHight),$("#display-panel").height(panelHight-send_panel_height-offset)},isMobile=function(){for(var userAgentInfo=navigator.userAgent,mobileAgents=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],mobile_flag=!1,v=0;v<mobileAgents.length;v++)if(userAgentInfo.indexOf(mobileAgents[v])>0){mobile_flag=!0;break}var screen_width=window.screen.width,screen_height=window.screen.height;return screen_width<500&&screen_height<800&&(mobile_flag=!0),mobile_flag},fullData=[],fullDatacnt=0,fullDatalayout=function(){var interv=window.setInterval((function(){fullData.length>0&&(fullDatacnt>=fullData.length&&(clearInterval(interv),fullDatacnt=0,window.setTimeout(fullDatalayout,2e3)),$("body").barrager(fullData[fullDatacnt++]))}),500)},loadData=function(){$.get("/danmu/get/",(function(r){fullData=[],r.forEach(e=>{fullData.push({img:iconTranslate[e.icon],href:"#",close:!1,info:e.text,color:e.color})})}))},triggerLoggedin=function(){$("#danmu-logout").show(),loadData(),window.setInterval(loadData,1e4)},loadBalanceServer=function(){var callback,service_name="在线开学手册",ext_url="?service_name=在线开学手册&callback="+(location.protocol+"//"+location.host+"/danmu/external_login/?param=");balanceServer.forEach((e,i)=>{$("#balanceServerList").append(`<a class="dropdown-item" href="${e+ext_url}">服务器${i+1}</a>`)})},enterStageMode=function(e){$("#navbar-container").hide(),$("#send-panel").hide(),$("#display-panel").css("padding","0px"),fitScreen(1)},danmuBackgroundAutuChange=function(){var full=$("#danmu-background li").size(),current=0;full>0&&$("#danmu-background").find("li").eq(0).show(),backgroundInterval=window.setInterval((function(){++current>=full&&(current=0),$("#danmu-background").find("li").eq(current).fadeIn(500).siblings().fadeOut(500)}),8e3)},loadDanmuBackground=function(ismobile){var imggroup,finalhtml="";(ismobile?backgroundImage.small:backgroundImage.large).forEach(v=>{finalhtml+=`<li style="display:none;"><img src="${v}" class="rounded"></img></li>`}),$("#danmu-background").html(finalhtml)};$("#send-danmu-form").submit((function(e){e.preventDefault();var danmu_text=$("#danmu-text").val(),danmu_color=$("#color-celection").val(),danmu_icon=Number($("#icon-celection").val());if(""==danmu_text||lockDown||danmu_text.length>40)swal("提示","发送失败：内容为空或长度超过限制","error");else{var danmu_config={img:iconTranslate[danmu_icon],info:"",href:"#",close:!1,color:danmu_color,old_ie_color:"#ffffff"};$("#danmu-text").val(""),$.post("/danmu/send/",{text:danmu_text,icon:danmu_icon,color:danmu_color},(function(r){if(1==r.status){danmu_config.info=r.text,$("body").barrager(danmu_config),lockDown=!0,submitButton.attr("disabled",!0);var locktime=3e3;setTimeout((function(){lockDown=!1,submitButton.attr("disabled",!1)}),3e3)}else-2==r.status?swal("提示","您的账号已被封禁","error"):swal("提示","发送未知错误 状态码"+r.status,"error")}))}})),$("#yunxiao-login").submit((function(e){e.preventDefault();var username=$("#yunxiao-username").val(),password=$("#yunxiao-password").val(),captchacode=$("#yunxiao-captchacode").val(),captchavalue=$("#yunxiao-captchavalue").val();""!=username&&""!=password?$.post("/danmu/login/",{username:username,password:password,captchacode:captchacode,captchavalue:captchavalue},(function(r){0==r.status?($("#loginModal").modal("hide"),window.location.reload()):-1==r.status?swal("登录失败","用户名或密码错误","error"):-2==r.status?($("#yunxiao-captchacode").val(r.captchacode),$("#yunxiao-captchaarea").show(),$("#yunxiao-captchadisplay").attr("src","https://account.yunxiao.com/captcha/"+r.captchacode+"?t="+(new Date).getMilliseconds()),swal("登录失败","用户名或密码错误","error")):-3==r.status?swal("登录失败","账号已被冻结请10分钟后再试","error"):3==r.status?swal("登录失败","验证码已过期请刷新页面","error"):swal("登录失败","服务器出现了一个未知错误","error")})):swal("登录失败","请填写所有内容","error")})),$("#color-celection").colorpicker({allowEmpty:!1,color:"#ffffff",showInput:!1,showInitial:!0,showPalette:!0,showSelectionPalette:!0,showAlpha:!1,maxPaletteSize:7,preferredFormat:"hex"}),$("#yunxiao-login-local").click((function(){$("#yunxiao-login-form").toggle(),$("#yunxiao-login-submit").toggle(),$("#yunxiao-login-notice").toggle()})),$("#color-celection").change((function(e){$("#color-celection").css("color",e.value.toString())})),$("#enter-stagemode").click(enterStageMode),$(document).ready((function(){fitScreen(0),$(".selectpicker").selectpicker({showIcon:!0}),loadBalanceServer(),loadDanmuBackground(isMobile()),fullDatalayout(),danmuBackgroundAutuChange(),$(window).resize((function(){fitScreen(0)})),"true"==window.loggedIn?(triggerLoggedin(),SMmuiscPlay({el:"danmu",audioUrl:"/static/audio/background.mp3",position:"top:10px;right:10px",animaClass:"muiscIconRotate"})):$("#loginModal").modal({backdrop:"static",keyboard:!1})}))}));